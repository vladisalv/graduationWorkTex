\chapter{Исследование и построение решения} \label{chapt1}

\section{Математическая модель поиска повторов в биологических последовательностях}

Формально {\bf биологическая последовательность}:
$$
X = (x_n)_{n=1}^N ,~ N \in \mathbb{N},~ x_n \in \{A,T,G,C\},
$$
где $N$ - длина последовательности, $A, T, G, C$ - озбоначения нуклеотидов.

\bigskip

Введем обозначение. {\bf Подпоследовательностью $X|_i^k$} последовательности $X$
называется часть последовательности $X$ с элемента с номером $i$ длиной $k$
при условии $i+k<|X|$:
$$
X|_i^k=\{x_i,x_{i+1},...,x_{i+k-1}\}
$$

\bigskip

Под {\bf повтором} будем понимать пару последовательностей (X$_1$,X$_2$) для которых
справедливо неравенство:
$$
\rho(X_1,X_2) \le \varepsilon,~|X_2|=|X_2|=K
$$
где:
\begin{itemize}
    \item $\rho(X_1,X_2)$ - расстояние редактирования, оценка близости последовательностей,
        Конкретный вид функции расстояния редактирования $\rho(X_1,X_2)$~ {\bf определяется алгоритмом}
    \item $\varepsilon$ - задаваемая точность поиска, значение которой будет {\bf зависеть от задаваемой функции растояния редактирования}
    \item $K$ - длина последовательностей
\end{itemize}

\bigskip

Пусть есть две последовательности $X=(x_n)_{n=1}^{N_x}$ и $Y=(y_n)_{n=1}^{Nk_y}$.\\
Под {\bf задачей поиска повторов} будем понимать нахождение всех троек $\{i_x,i_y,k\},
\ i_x,i_y,k \in \mathbb{N}$, таких что:\\
\begin{center}
    $i_x+k \le N_x$\\
    $i_y+k \le N_y$\\
    $(X|_{i_x}^k,Y|_{i_y}^k)$ - повтор длины k
\end{center}
То есть задача найти все такие подпоследовательности последовательностей $X$ и $Y$,
что эти подпоследовательности будут повторами.

\clearpage







\section{Спектрально-аналитический метод поиска повторов}
В работе исследуется спектральный метод поиска повторов в биологических последовательностях
предложенный и разработанный коллективом кафедры математических методов
прогнозирования и института математических проблем в биологии Российской академии
наук (Пущино).

\bigskip
Метод разбивается на четыре основных этапа:
\begin{enumerate}
  \item Получение профилей биологических последовательностей
  \item Спектральное индексирование полученных профилей
  \item Сравнение коэффициентов спектрального разложения и построение гомологической матрицы
  \item Анализ гомологической матрицы
\end{enumerate}

\bigskip

\subsection{Профили биологических последовательностей} \label{sect2_1}

Одной из главных особенностей рассматриваемого метода поиска повторов является
то, что на первом этапе последовательность преобразуется из дискретной в непрерывную
область. Это достигается построением т.н. профилей.

\bigskip

Под GC-профилем последовательности $X = (x_n)_{n=1}^{N_x}$ с окном $w$ в дальнейшем
будем понимать такую последовательность $P_{GC}(X,w)=(p_n^{GC})_{n=1}^{N_p},
N_p=N_x-w+1$, что
$$
p_i^{GC}=\sum_{k=i}^{i+w}I^{GC}(x_k), i=\overline{1,N_p}
$$

где
$$
I^{GC}=
  \begin{cases}
    1,~x_n \in \{G,C\} \\
    0,\text{~иначе}
  \end{cases}
, n = \overline{1,N_x}
$$

\bigskip
\bigskip

Понятие GA-профиля определяется аналогично:
$$
P_{GA}(X,w)=(p_n^{GA})_{n=1}^{N_p}:
p_i^{GA}=\sum_{k=i}^{i+w}I^{GA}(x_k), i=\overline{1,N_p},
$$
где
$$
I^{GA}=
  \begin{cases}
    1,~x_n \in \{G,C\} \\
    0,\text{~иначе}
  \end{cases}
, n = \overline{1,N_x}
$$
\clearpage



\subsection{Спектральное индексирование профилей} \label{sect2_2}

На этом этапе профили переводятся в спектральное представление с использованием
в качестве базиса полиномов Чебышева дискретного аргумента или функций Фурье.

\bigskip

Под спектральным представлением сигнала $P=(p_n)_{n=1}^{N_p}$ будем понимать вектор
$\overline{C}=C_m(P)=(c_0,...,c_{m-1})$, где $c_0,...,c_{m-1}$ - первые $m$
коэффициентов разложения сигнала P по некоторой системе ортогональных функций
$u_0(x),...,u_{m-1}(x),...$


\bigskip

Полиномы Чебышева определяются при помощи рекуррентного соотношения:\\
$$ u_0(x)=1 $$
$$ u_1(x)=x $$
$$ ... $$
$$ u_{n+1}(x)=2xu_n(x)-u_{n-1}(x) $$

\bigskip

Вычисление коэффициентов разложения в обоих случаях выполняется по
рекуррентным соотношениям.

\bigskip

\subsection{Спектральное сравнение профилей} \label{sect2_3}

На этой стадии спектральное представление профилей используется для
производства сравнения на основе некоторого специально разработанного критерия.

Теперь можно ввести понятие расстояния редактирования для рассматриваемого
метода поиска повторов.

Пусть $X_1,X_2$ - две биологические последовательности, такие что $|X_1|=|X_2|=K \ge w$.\\
Будем понимать под GC- и GA-расстоянием редактирования для $X_1$ и $X_2$:
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
$$ \rho^{GC}(X_1,X_2)= \norm{\overline{C_1^{GC}} - \overline{C_2^{GC}}}, $$
$$ \rho^{GA}(X_1,X_2)= \norm{\overline{C_1^{GA}} - \overline{C_2^{GA}}}, $$
$$ \norm{\overline{C}}=\sum_{i=0}^{m-1}c_i^2 $$

\bigskip

Под повтором будем понимать пару последовательностей $X_1,X_2$,
удовлетворяющих системе:

\bigskip

$$
  \begin{cases}
      \rho^{GC}(X_1,X_2) < \varepsilon \\
      \rho^{GA}(X_1,X_2) < \varepsilon \\
  \end{cases}
$$

\clearpage


Под матрицей гомологии окном профилей w, окном аппроксимации a и шагом
аппроксимации s для последовательностей $X_1,X_2$ будем понимать матрицу
$$
\begin{array}{rl}
    M(X,Y,w,s,a)=(m_{ij})^{L_x \times L_y}, \\
      \\
    L_x=[\frac{N_x-a-w+1}{s}],L_y=[\frac{N_y-a-w+1}{s}] \\
      \\
    m_{ij}=
    \left\{
      \begin{array}{rl}
        1,~x_n \in \{G,C\} \\
        0,~$иначе$ \\
      \end{array}
    \right.
\end{array}
$$

\bigskip
\bigskip

\begin{figure}[h]
\center{\includegraphics[width=0.5\linewidth]{image/cool.jpg}}
\caption{Пример гомологической матрицы}
\label{img:gomology}
\end{figure}

На рисунке \ref{img:gomology} приведена гомологическая матрица, образованная
в результате сравнения последовательности с самой собой. Матрица имеет
симметричный вид.

\bigskip

\bigskip

\subsection{Анализ гомологической матрицы} \label{sect2_4}

Рассмотрим все диагонали гомологической матрицы параллельные главной диагонали,
включая ее саму. Фиксируем диагональ $D_l$.
Назовем диагональным элементом $R(x, y, k)$ такое множество элементов $m_{ij}$
гомологической матрицы $M^{L_x \times L_y}$, что:
$$ m_{ij} \in D_l$$
$$ m_{ij} = 1,\quad i = \overline{y,y\!+\!k-1}, \quad j = \overline{x,x+k-1}, k \in \mathbb{N}$$
$$ m_{x-1,y-1} = 0, \text{если}~x > 0, y > 0$$
$$ m_{x+k,y+k} = 0, \text{если}~x+k < L_x , y+k < L_y$$

На последнем этапе анализа гомологической матрицы нужно найти все
диагональные элементы этой матрицы. Зная параметры алгоритма по диагональным
элементам можно восстановить искомые повторы.

\clearpage


\begin{figure}[h]
\center{\includegraphics[width=0.5\linewidth]{image/shemeAlgorithm.png}}
\caption{Схема работы спектрально-аналитического метода поиска повторов}
\label{img:shemeAlgorithm}
\end{figure}

%На рисунке \ref{img:shemeAlgorithm} представлена общая схема работы спектрально-аналитического метода.

\clearpage

\section{Параллельный метод поиска повторов}

Основная идея паралллельного алгоритма поиска повторов заключается
в равномерном распределении входных данных по процессам и их независимой обработке,
запрашивая недостающие элементы у соседних процессов.

\begin{figure}[h]
\center{\includegraphics[width=0.7\linewidth]{image/phase12.png}}
\caption{Параллельная схема работы этапа профилирования и спектрального индексирования}
\label{img:phase12}
\end{figure}

На рисунке \ref{img:phase12} представлена схема выполнения первых двух этапов: получения профиля
биологической последовательности и спектрального индексирования.

На каждом этапе процесс получает недостающие элементы у соседнего процесса и выполняет
обработку данных. Причем каждый процесс может начинать работу не дожидаясь завершения
приема данных, т.к. они понадобятся только в конце работы. Таким образом можно
скрыть передчу данных на фоне выполнения полезной работы и добиться ситуации,
когда процессор не будет простаивать на фоне ожидания данных.


\begin{figure}[h]
\center{\includegraphics[width=0.7\linewidth]{image/p10.png}}
\caption{Этапы 1 и 2}
\label{img:p10}
\end{figure}

Иначе обстоит дело с этапом спектрального сравнения. Здесь каждый процесс будет 
отвечать за построение набора строк гомологической матрицы, которые соответствуют
спектрам из набора первой последовательности. (см рис)

Для выполнения данного этапа процессу требуются данные со всех процессов.
Однако и здесь можно добиться отсутствия простоя вычислительных платформ,
если не дожидаться получения всех данных,
а начинать работу по возможности - как только придут данные хотя бы с одного процесса.
Таким образом можно скрыть большую часть пересылок данных за полезными вычислениями
и добиться хорошей масштабируемости алгоритма.

На последнем этапе каждый процесс анализирует имеющуюся часть гомологической
матрицы на наличие диагональных элементов. Однако следует учитывать, что найденный
диагональный элемент может иметь свое начало или окончание на другом процессе,
поэтому нужно "склеить" диагональные элементы с разных процессов.

Здесь будем действовать по следующему принципу: процесс "склеивает" диагональный элемент
(т.е. ищет его целиком), только если диагональный элемент принадлежит нашему процессу.
Диагональный элемент $R(x, y, k)$ принадлежит процессу $i$, если начало этого повтора находится на процессе $i$, т.е.:
$$ m_{xy} \in M_i^{L_x \times L_y}, \text{где}~M_i^{L_x \times L_y} - \text{гомологическая матрица, вычесленная на процессе}~i$$

Таким образом алгоритм анализа будет работать следующим образом:
\begin{enumerate}
    \item Найти все диагональные элементы
    \item Удалить диагональные элементы, не принадлежащие нашему процессу
    \item Найти конец всех диагональных элементов
\end{enumerate}


\clearpage
